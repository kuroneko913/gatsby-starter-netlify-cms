---
title: timesから今週を振り返る
date: 2023-06-25T22:56:55.840Z
description: timesから今週を振り返る
---
# はじめに
会社のSlackにtimes(分報)がある。そこには私は、業務中に感じたことや、タスクの整理、あとで見るリンクやタスクを雑に投げておくことが多い。大抵はただの落書きだが、その当時の自分が何を考えていたのか、どんな課題にぶつかってどう乗り越えたのかが残っている資料の一つでもある。

そこでこのtimesに投稿した内容を1週間に1回振り返って、ブログに投稿してみるという企画をやってみようと思う。仕事に密接に関わる呟きなどは出来る限り、抽象化して外に出しても問題がないようにするつもりである。

これは、カンファレンスや勉強会などのプロポーザルを出すのに悩みがちな自分を変える、すなわちいつでも話せるネタに困らないようになる訓練でもあると思う。

# 2023-06-18 ~ 2023-06-24
## [mysql-build-debug-and-test](https://speakerdeck.com/lrf141/mysql-build-debug-and-test)

MySQLの実装をデバッグしながら理解するために、デバッグモードでBuild。
[mysql-test-run](https://dev.mysql.com/doc/dev/mysql-server/latest/PAGE_MYSQL_TEST_RUN_PL.html)というMySqlServerのE2Eテストを行うコマンドで様々なテストケースを実行しながら挙動を探るという話。うむ、こういう世界もあるんだな、程度の理解。

## テストコードを書くときの些細なメモ
> テストコードで特に@dependsしたときに渡される変数のdocコメントを忘れがち。

[PHPUnitでテストメソッド間の依存性を表現する](https://qiita.com/kseta/items/f718ac3f964d1c0fea2c)

にあるようにPHPUnitでテストメソッド間の依存性を表現することができると知って以来、依存性を意識してテストを書いている。
が、最近@dependsを書くようになったのと、テストコードも PHP doc comment を書くように意識し始めたのが最近なのもあって、
@dependsしたときに渡す引数のdoc commentを書き忘れがちという話。

```php

class HogeTest extends PHPUnit_Framework_TestCase
{
    /**
     * @test
     * @return string[] 追加されたレコードの配列
     */
    public function create_レコードが1件追加されること()
    {
        // 1件追加されることのテスト

        //追加されたレコードを取得して返す
        return $actual;
    }

    /**
     * @test
     * @depends create_レコードが1件追加されること
     * @param string[] $actual
     * @return void
     */
    public function create_項目Aが追加されていること(array $actual)
    {
        $this->assertSame('aaaa', $actual['A'], '項目Aが追加されていない');
    }
}

```

上記のような依存のあるテストを書くときに、docコメントから書かないことが原因なんだろうと個人的に思ってる。docコメントから書く癖をつけるように心がけたい。

## Repositoryが投げる例外について
普段の開発でDDDを意識して開発したいよね、ということでRepositor
yパターンを取り入れて開発している。RepositoryなのでPDO Exceptionが発生したり、それ以外の例外が発生する可能性があった。
そんなときにいちいちそれぞれの例外が発生してしまう状態だとこのRepositoryは一体どの例外を返すのだ？となってしまうので、以下の例のように例外を投げなおして一つの例外にまとめるようにすると良さそうというメモ。

```php

class XXXRepository implements XXXRepositoryInterface
{
    // いろいろ省略
    public function create()
    {
        try {
            // 保存する処理
        } catch (Exception $e) {
            throw new RuntimeException('保存に失敗', 0, $e);
        }
    }
}

```



```
移行期間終わるの早すぎじゃね？と思ったけどslackくらい思い切ってた方がいいのかな？
ワークフローのボタンの話。

https://logmi.jp/business/articles/328802

ユースケースなんだから、ある程度複雑にはなる気がするんだよな。
ユースケースにロジックを詰め込んでしまうと、見通しが悪くなり、全体として何をやっているかがわからなくなります。DDDでは、ユースケースはドメインオブジェクトのメソッドを呼び出す単純な処理がメインになるので、何をやっているかがコードを見ただけで明確にわかります。
https://zenn.dev/hisamitsu/articles/2937fc4dd9bd4c

https://tech.012grp.co.jp/entry/laravel-ddd-repository-test

なんか投稿して、
先着10名だけに生の投稿内容を表示して、
それ以降は閲覧数が10増えるごとに表示できる文字数か利用できる文字数が減って不完全な投稿が表示されるようになったらおもしろいか？
Twitterで想像したけどただのカオスか。
Zennとかの記事投稿プラットフォームで、
ある一定の閲覧数を超えたら、
ChatGPTによる要約文に置き換わるとかすれば、詳細とか具体例とか知りたかったら早めに見てねーとかできる？
なんの意味があるのか分からないけど。
たとえばこの投稿も一定時間後には、
「アイデア　閲覧数　制限　投稿プラットフォーム　需要は分からん」とかになるのかな？

利用できる文字数が減るという発想は、完全にあいうえバトルから来てそうだな。

雑な読書メモを投げて、
なんでも良いから投稿したという事実だけが残るようにする。
自分はいつでも見れるけど、そのほかの人には、読んだページ数とその時の読者の気持ちを表した:blush:とChatGPTによる要約文しか見れない。

https://qiita.com/Yametaro/items/f38cfd26dcf5988f3c34

リリース手順をミスってしまい、ヒヤリハットをやらかしたから、ワークフローで解決しておきます。

よくよく考えれば変なことやってるのわかるんだけど、やっぱ頭働いてなかったな。
寝起きはダメだ。

https://qiita.com/marumaru0113/items/c53db580b812f8f6d4da

https://speakerdeck.com/o0h/chronos

あとで見たい。鷹の爪団、結構好き。
【警察庁】鷹の爪団のサイバー犯罪撲滅大作戦　一分でわかる、IoT機器乗っ取り編
https://youtu.be/NvFyCgJYroY

https://www.slideshare.net/masuda220/ddd-forname

メソッドの行数は3行のものなんて作れるのか？
一部はできるけど全部は無理では？っていうのをみたときに思想強すぎね？ってなるんだろうな。
ここで無理なの承知でできるだけ心がける、どうすればできそうか考えるっていうのが苦手なのかな。

PRとかレビュー会でクラスの命名、メソッドの命名のより適切なのを考える時間にいつも思うのは、
これ説明されてなんとか理解できたけど、自分でこれに気づけるようにならないとダメなんだろうなって。
そもそも、これで良いと思ってるからレビューの場に出てくるわけで。視点がまだまだ足らないんだろうな。

Order問題を考える(抽象化して説明を試みる)

https://twitter.com/j5ik2o/status/1672399395642568706?s=46&t=PypAHIk9fKMiUjAzKsImHA

https://qiita.com/98lerr/items/9b1c50348dcaa925e1a5
```